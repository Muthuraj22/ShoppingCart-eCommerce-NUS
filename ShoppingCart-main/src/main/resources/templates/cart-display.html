
<!--
Author: Muthu Raj, Maha, Priya
-->

<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" th:href="@{/css/navbar.css}">
    <title>Cart Page</title>

    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', sans-serif;
        }

        .cart-card {
            max-width: 800px;
            margin: 2rem auto;
            background-color: #ffffff;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        .cart-table th, .cart-table td {
            vertical-align: middle;
            text-align: center;
        }

        .cart-table td form button {
            padding: 0.25rem 0.5rem;
            font-size: 1rem;
        }

        .btn-action {
            margin: 0 0.25rem;
        }

        .btn-continue, .btn-checkout {
            min-width: 150px;
        }

        .total-row {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .empty-cart {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>
<!-- Navbar -->
<div th:replace="~{fragments/navbar :: navbar}"></div>

<div class="cart-card">
    <h2 class="text-center mb-4">Shopping Cart</h2>

    <!-- Continue Shopping Button -->
    <div class="mb-3 text-start">
        <form th:action="@{/products}" method="get">
            <button type="submit" class="btn btn-outline-dark btn-continue">
                <i class="bi bi-shop"></i> Continue Shopping
            </button>
        </form>
    </div>

    <!-- Empty Cart Message -->
    <div th:if="${cart == null or cart.cartItems == null or #lists.isEmpty(cart.cartItems)}" class="text-center empty-cart mb-3">
        Your cart is empty. Start shopping to add items!
    </div>

    <!-- Cart Table -->
    <table th:if="${cart != null and cart.cartItems != null and !#lists.isEmpty(cart.cartItems)}" class="table table-bordered cart-table">
        <thead class="table-light">
        <tr>
            <th>Product Name</th>
            <th>Unit Price</th>
            <th>Quantity</th>
            <th>Price</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="cartItem : ${cart.cartItems}">
            <td th:text="${cartItem.product.name}">ProductName</td>
            <td th:text="'$ '+${#numbers.formatDecimal(cartItem.product.unitPrice,1,2)}">UnitPrice</td>
            <td>
                <!-- Reduce Quantity -->
                <form th:action="@{/cart/items/reduce}" method="post" style="display:inline;">
                    <input type="hidden" name="productId" th:value="${cartItem.product.id}"/>
                    <input type="hidden" name="redirect" value="cart"/>
                    <button type="submit" class="btn btn-outline-secondary btn-action">-</button>
                </form>

                <span th:text="${cartItem.quantity}" class="mx-2"></span>

                <!-- Add Quantity -->
                <form th:action="@{/cart/items/add}" method="post" style="display:inline;">
                    <input type="hidden" name="productId" th:value="${cartItem.product.id}"/>
                    <input type="hidden" name="redirect" value="cart"/>
                    <button type="submit" class="btn btn-outline-secondary btn-action">+</button>


                    <!--/*@thymesVar id="outOfStockId" type="out of stock"*/-->
                    <div th:if="${outOfStockId==cartItem.product.id}" >
                        <script th:inline="javascript">
                            alert("Added quantity exceeds available quantity!!");
                        </script>
                    </div>
                </form>
            </td>
            <td th:text="'$ ' + ${#numbers.formatDecimal(cartItem.product.unitPrice * cartItem.quantity, 1, 2)}">Price</td>
            <td>
                <!-- Delete Item -->
                <form th:action="@{/cart/items/delete}" method="post">
                    <input type="hidden" name="productId" th:value="${cartItem.product.id}"/>
                    <input type="hidden" name="redirect" value="cart"/>
                    <button type="submit" class="btn btn-outline-danger btn-action">
                        <i class="bi bi-trash3"></i>
                    </button>
                </form>
            </td>
        </tr>

        <!-- Total Row -->
        <tr>
            <td colspan="3" class="text-end total-row">Total:</td>
            <td colspan="2" class="total-row" th:text="'$ ' + ${#numbers.formatDecimal(totalPrice, 1, 2)}">TotalPrice</td>
        </tr>
        </tbody>
    </table>

    <!-- Checkout Button -->
    <div class="text-center mt-4">
        <form th:if="${cart != null and cart.cartItems != null and !#lists.isEmpty(cart.cartItems)}" th:action="@{/orders/checkout}" method="get">
            <button type="submit" class="btn btn-primary btn-checkout">
                <i class="bi bi-cart-check"></i> Checkout
            </button>
        </form>

        <p th:if="${cart == null or cart.cartItems == null or #lists.isEmpty(cart.cartItems)}" class="mt-3">
            Add items to your cart before checking out.
        </p>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
